<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Prosjektregistrering</title>
  <style>
  @import url('https://fonts.googleapis.com/css?family=Roboto');
  body{
    margin:0;
    padding:0;
    font-family: "Roboto",sans-serif;
    color: #2E3539
  }
  #header{
    display: flex;
    background-color: #ED9300;
    justify-content: center;
    align-items: center;
    border-bottom: 1px #c37900 solid;
  }
  .wrapper{
    display:flex;
    }

  .sidepanel{
    flex: 1 1 auto;
  }
  .hovedpanel{
    flex: 0 1 850px;
    border: 3px #c37900 solid;
    min-width: 0;
  }

  button.accordion {
      background-color: #e8af51;
      color: #2E3539;
      cursor: pointer;
      padding: 18px;
      width: 100%;
      border: none;
      text-align: left;
      font-weight: bold;
      outline: none;
      font-size: 1.3em;
      transition: 0.4s;
  }

  button.accordion.active, button.accordion:hover {
      background-color: #ED9300;
  }

  button.accordion:after {
      content: '\002B';
      color: #777;
      font-weight: bold;
      float: right;
      margin-left: 5px;
  }

  button.accordion.active:after {
      content: "\2212";
  }

  div.panel {
      padding: 0 18px;
      background-color: white;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.2s ease-out;
  }

  .aapen{
    max-height: 1500px !important;
  }

  .formitem{
    margin-bottom: 25px;
    font-size: 1.2em;
  }

  input[type=text],input[type=email],select {
      padding: 12px 20px;
      margin: 8px 0;
      background-color: #ede0ca;
      display: inline-block;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 1.1rem;
  }

  input[type=month]{
    width: 200px;
    padding: 12px 20px;
    margin: 8px 0;
    background-color: #ede0ca;
    display: inline-block;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    font-size: 1.1rem;
  }


  #prosjektinfo{
    display: flex;
    flex-flow: column;
  }

  #kart{
    padding:0;
  }

  #viewDiv {
    padding: 0;
    margin: 0;
    height: 80vh;
    max-height: 700px;
    width: 100%;
  }

  #baseToggle{
  /*position: relative;*/
  /*margin-right: 10px;*/
  }
  #baseToggle img{
    left: 0px;
    bottom: 0px;
    border: 2px #ecc347 solid;
    position: absolute;
    transition: all 0.5s;
    border-radius: 10px;
  }

  .esri-widget-button{
    color: #705402 !important;
    background-color: #ecc347 !important
  }

  .hide{
    opacity: 0;
  }

  @media only screen and (max-width: 768px) {
      /* For mobile phones: */
  .sidepanel{
    display: none;
  }

  .formitem{
    display: flex;
    flex-flow: column;
  }

  }

  </style>

  <link rel="stylesheet" href="https://js.arcgis.com/4.5/esri/css/main.css">
  <script src="https://js.arcgis.com/4.5/"></script>
  <script>
  var kartView,kart,diverseResultat, bakkeLag,hitResultat = {};
  require([
    "esri/Map",
    "esri/views/MapView",
    "esri/Basemap",
    "esri/layers/TileLayer",
    "esri/layers/FeatureLayer",
    "esri/geometry/Extent",
    "esri/geometry/SpatialReference",
    "esri/widgets/LayerList",
    "esri/widgets/Locate",
    "esri/Graphic",
    "esri/layers/ElevationLayer",
    "esri/Ground",
    "dojo/domReady!"
  ], function(
    Map,MapView,Basemap,TileLayer,
    FeatureLayer, Extent, SpatialReference,
    LayerList, Locate, Graphic,ElevationLayer,Ground
  ) {

    /************************************************************
     * Creates a new WebMap instance. A WebMap must reference
     * a PortalItem ID that represents a WebMap saved to
     * arcgis.com or an on-premise portal.
     *
     * To load a WebMap from an on-premise portal, set the portal
     * url with esriConfig.portalUrl.
     ************************************************************/
    var nvdbBasemap = new TileLayer({
       url: "https://nvdbcache.geodataonline.no/arcgis/rest/services/Trafikkportalen/GeocacheTrafikkJPG/MapServer",
       id:"NVDB-trafikk"
     });
    var bilder = new TileLayer({
        url: "https://services.geodataonline.no/arcgis/rest/services/Geocache_UTM33_EUREF89/GeocacheBilder/MapServer",
        id: "Bilder",
        visible: false
      });
      /*var fl = new FeatureLayer({
        url: "https://kart.tromso.kommune.no/arcgis/rest/services/Temadata/FlyplassTema/MapServer/5",
        id: "testlag"
      });*/

      var bakke = ElevationLayer({
        url: "https://services.geodataonline.no/arcgis/rest/services/Geocache_UTM33_EUREF89/GeocacheTerreng/ImageServer"
      });
      bakkeLag = bakke
     var nvdbBasemap = new Basemap({
       baseLayers: [nvdbBasemap],
       title: "NVDB",
       id: "nvdb"
     });

     // Create a Map instance
     var map = new Map({
       basemap: nvdbBasemap,
       ground: new Ground({
         layers: [bakke]
       }),
       layers: [bilder]
     });

    kart = map

    var extent = new Extent({
      xmin: 373601,
      ymin: 7507874,
      xmax: 721751,
      ymax: 7743925,
      spatialReference: new SpatialReference({wkid:25833})
    })

    /************************************************************
     * Set the WebMap instance to the map property in a MapView.
     ************************************************************/
    var view = new MapView({
            map: map,
            container: "viewDiv"
          });
    view.constraints.rotationEnabled = false;
    var locateWidget = new Locate({
      view: view,   // Attaches the Locate button to the view
      graphic: new Graphic({
        symbol: { type: "simple-marker" }  // overwrites the default symbol used for the
        // graphic placed at the location of the user when found
      })
    });

    var layerList = new LayerList({
      view: view
    });



    kartView = view

    view.extent = extent
    view.ui.add("baseToggle","bottom-left");
    //view.ui.add(layerList, "top-left");
    view.ui.add(locateWidget, "top-left");
    //test = view;

   view.then(function(){
   var baseToggle = document.querySelector("#baseToggle");
   var img = document.querySelectorAll("#baseToggle img");
   var lag = {}

   baseToggle.classList.remove("hide");
   bilder.load().then(function(){
    map.allLayers.items.forEach(function(element){
      lag[element.title] = element;
    })
   baseToggle.addEventListener("click", function(){
     img[0].classList.toggle("hide");
     img[1].classList.toggle("hide");

     lag["GeocacheBilder"].visible = !lag["GeocacheBilder"].visible;
     lag["GeocacheTrafikkJPG"].visible = !lag["GeocacheTrafikkJPG"].visible;


      //test = lag;

       })
   })
   })


    view.on("click", function(event) {
        view.hitTest(event).then(function(response){
          hitResultat = response
          bakke.queryElevation(hitResultat.screenPoint.mapPoint).then(function(results){
            diverseResultat = results
            console.log(results)
          })
        })


         // you must overwrite default click-for-popup
         // behavior to display your own popup
         event.stopPropagation();

         var screenPoint = {
           x: event.x,
           y: event.y
         }

         view.popup.open({
           // Set the popup's title to the coordinates of the location
           title: "Geokoding",
           location: event.mapPoint, // Set the location of the popup to the clicked location,
           content: "<a href='https://www.vegvesen.no/vegkart/vegkart/#kartlag:geodata/@"+view.toMap(screenPoint).x.toString().split(".")[0]+","+view.toMap(screenPoint).y.toString().split(".")[0]+","+view.zoom+"' target='#'>Link til vegkart</a>"  // content displayed in the popup
         });
        });

  });
  </script>
</head>
<body>
  <div class="wrapper">
    <div class="sidepanel"></div>
    <div class="hovedpanel">
      <div id="header">
        <h2>Prosjektregistrering</h2>
      </div>
      <button class="accordion">Prosjektinfo</button>
      <div id="prosjektinfo" class="panel">
        <p>I denne seksjonen skal det fylles ut informasjon om prosjektets navn, estimert ferdigtidspunkt og referanser</p>
        <form name="prosjektregistrering" action="index.html" method="post">
          <div class="formitem">
            <label for="prosjektnavn">Prosjektnavn</label>
            <input type="text" name="prosjektnavn" placeholder="Skriv inn prosjektets navn" required>
          </div>

          <div class="formitem">
            <label for="ferdigdato">Ferdigdato</label>
            <input type="month" name="ferdigdato" required>
            <small>Om sluttdato er ukjent velg første dag i måneden</small>
          </div>

          <div class="formitem">
            <label for="vegreferanse">Vegreferanse</label>
            <input type="text" name="vegreferanse" placeholder="Skriv inn vegreferanse" required>
          </div>



          <div class="formitem">
            <label for="vegavdeling">Vegavdeling</label>
            <select name="vegavdeling">
              <option value="Finnmark">Finnmark</option>
              <option value="Troms">Troms</option>
              <option value="Midtre-Hålogaland">Midtre-Hålogaland</option>
              <option value="Nordland">Nordland</option>
            </select>
          </div>

          <div class="formitem">
            <label for="seksjon">Seksjon</label>
            <select name="seksjon">
              <option value="TS">TS</option>
              <option value="Prosjekter">Prosjekter</option>
              <option value="Investering">Investering</option>
              <option value="Drift og vedlikehold">Drift og vedlikehold</option>
              <option value="Annet">Annet</option>
            </select>
          </div>

          <h3>Kontaktinformasjon</h3>

          <div class="formitem">
            <label for="kontaktperson">Kontaktperson i SVV</label>
            <input type="text" name="kontaktperson" placeholder="Kontaktperson for prosjektet" required>
          </div>

          <div class="formitem">
            <label for="epost">Epost</label>
            <input type="email" name="epost" placeholder="Skriv inn epost" required>
          </div>
        </form>

        <div id="validering" class="message">
        </div>
        <p>Om skjemaet er utfyllt kan du gå videre til registrering av prosjektets plassering.</p>
      </div>

      <button class="accordion">Stedfesting</button>
      <div id="kart" class="panel">
        <div class="">
          <p>Registrer prosjektets plassering som linje eller areal</p>
        </div>
        <div id="viewDiv">
          <div id="baseToggle" class="hide">
            <img id="baseSVV" class="hide" src="img/baseSVV.jpg" >
            <img id="baseBilde" src="img/baseBilde.jpg" >
          </div>
        </div>
      </div>

      <button class="accordion">Send inn</button>
      <div id="submit" class="panel">
        <div class="message"></div>
        <input type="submit" name="submit" value="Send inn">
        <p>Vil du registrere et nytt prosjekt? </p>
      </div>
    </div>
    <div class="sidepanel"></div>
  </div>
  <script>
  var acc = document.getElementsByClassName("accordion");
  var i;

  for (i = 0; i < acc.length; i++) {
    acc[i].onclick = function() {
      Array.prototype.map.call(acc, function(obj) {
            console.log("Her er før",obj.classList);
            obj.classList.remove("active");
            obj.classList.remove("aapen");
            console.log("Her er etter",obj.classList);
          })
      this.classList.toggle("active");
      var panel = this.nextElementSibling;
      this.nextElementSibling.classList.toggle("aapen")
    }
  }
  </script>
</body>
</html>
